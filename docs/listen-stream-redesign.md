# ğŸµ Listen Stream ç³»ç»Ÿé‡æ„æ–¹æ¡ˆï¼ˆå®Œæ•´ç‰ˆï¼‰

> **åŸºäº**: p2.md å…¨é¢åˆ†ææŠ¥å‘Š  
> **ç‰ˆæœ¬**: 2.0  
> **æ—¥æœŸ**: 2026-02-26  
> **åŸåˆ™**: ä»é›¶å¼€å§‹è®¾è®¡ï¼Œå……åˆ†ä½“ç°æ‰€æœ‰æ”¹è¿›å»ºè®®

---

## ğŸ“‹ ç›®å½•
1. [åŠŸèƒ½å»ºæ¨¡](#1-åŠŸèƒ½å»ºæ¨¡)
2. [æ¶æ„è®¾è®¡ï¼ˆèå…¥æ‰€æœ‰æ”¹è¿›ï¼‰](#2-æ¶æ„è®¾è®¡)
3. [æŠ€æœ¯é€‰å‹](#3-æŠ€æœ¯é€‰å‹)
4. [å®ç°è·¯çº¿å›¾](#4-å®ç°è·¯çº¿å›¾)
5. [é€æ­¥æ‰§è¡Œ](#5-é€æ­¥æ‰§è¡Œ)

---

## 1. åŠŸèƒ½å»ºæ¨¡

### 1.1 æ ¸å¿ƒé¢†åŸŸæ¨¡å‹

#### é¢†åŸŸ1: èº«ä»½ä¸è®¤è¯ (Identity & Auth)
**æŠ€æœ¯æ ˆ**: Go + PostgreSQL + Redis

**å®ä½“æ¨¡å‹**:
```go
// User ç”¨æˆ·å®ä½“
type User struct {
    ID          string    // UUID
    Phone       string    // æ‰‹æœºå·ï¼ˆå”¯ä¸€ï¼‰
    Role        UserRole  // USER | ADMIN | SUPER_ADMIN
    Disabled    bool      // æ˜¯å¦ç¦ç”¨
    TokenVersion int      // Tokenç‰ˆæœ¬å·ï¼ˆæ–°å¢ï¼šæ”¯æŒå…¨å±€æ’¤é”€ï¼‰
    CreatedAt   time.Time
    UpdatedAt   time.Time
}

// Device è®¾å¤‡å®ä½“
type Device struct {
    ID           string    // UUID
    UserID       string    // å…³è”ç”¨æˆ·
    DeviceID     string    // å®¢æˆ·ç«¯ç”Ÿæˆçš„è®¾å¤‡ID
    Platform     Platform  // iOS, Android, Web, Desktop, TV
    RTHash       string    // Refresh Token SHA-256
    Fingerprint  string    // è®¾å¤‡æŒ‡çº¹ï¼ˆæ–°å¢ï¼šå¼‚å¸¸æ£€æµ‹ï¼‰
    IPAddress    string    // ç»‘å®šIPï¼ˆæ–°å¢ï¼šä¸¥æ ¼æ¨¡å¼ï¼‰
    LastActive   time.Time
    CreatedAt    time.Time
}

// SMSVerification çŸ­ä¿¡éªŒè¯
type SMSVerification struct {
    ID         string
    Phone      string
    Code       string    // 6ä½æ•°å­—
    Provider   string    // ä½¿ç”¨çš„SMSæä¾›å•†ï¼ˆæ–°å¢ï¼šå¤šå‚å•†ç»Ÿè®¡ï¼‰
    ExpiresAt  time.Time
    Verified   bool
    CreatedAt  time.Time
}

// SMSRecord çŸ­ä¿¡å‘é€è®°å½•ï¼ˆæ–°å¢ï¼šç»Ÿè®¡ä¸å®¡è®¡ï¼‰
type SMSRecord struct {
    ID         string
    Phone      string
    Provider   string    // aliyun | tencent | twilio
    Status     string    // sent | failed
    ErrorMsg   string    // å¤±è´¥åŸå› 
    CreatedAt  time.Time
}
```

**æ”¹è¿›ç‚¹ä½“ç°**:
- âœ… **Tokenç‰ˆæœ¬å·**: æ”¯æŒå¯†é’¥è½®æ¢æ—¶å…¨å±€æ’¤é”€æ—§Token
- âœ… **è®¾å¤‡æŒ‡çº¹**: æ£€æµ‹å¼‚å¸¸ç™»å½•ï¼ˆè®¾å¤‡ç‰¹å¾çªå˜ï¼‰
- âœ… **IPç»‘å®š**: å¯é€‰çš„ä¸¥æ ¼æ¨¡å¼ï¼ŒTokenç»‘å®šIP
- âœ… **SMSç»Ÿè®¡**: è®°å½•æ‰€æœ‰å‘é€è®°å½•ï¼Œæ”¯æŒå¤šå‚å•†fallback

---

#### é¢†åŸŸ2: APIç½‘å…³ä¸ç¼“å­˜ (API Gateway & Cache)
**æŠ€æœ¯æ ˆ**: Go + Redis (å¤šçº§) + Consul

**æ ¸å¿ƒç»„ä»¶**:
```go
// CacheLayer ç¼“å­˜åˆ†å±‚ï¼ˆæ–°å¢ï¼šä¸‰çº§ç¼“å­˜ï¼‰
type CacheLayer struct {
    L1 *MemoryCache    // çƒ­ç‚¹æ•°æ®ï¼Œ5åˆ†é’Ÿï¼Œæœ€å¤š1000æ¡
    L2 *RedisCache     // å¸¸è§„ç¼“å­˜
    L3 *StaleCache     // é™çº§ç¼“å­˜
}

// UpstreamSource ä¸Šæ¸¸æº
type UpstreamSource struct {
    Name     string    // QQ Music, Joox, NetEase, Kugou
    BaseURL  string
    Priority int       // ä¼˜å…ˆçº§ï¼ˆæ–°å¢ï¼šå¤šæºæ”¯æŒï¼‰
    Enabled  bool
    RateLimiter *rate.Limiter // é€Ÿç‡é™åˆ¶ï¼ˆæ–°å¢ï¼‰
}

// FallbackChain é™çº§é“¾ï¼ˆæ‰©å±•ï¼šæ”¯æŒæ›´å¤šæºï¼‰
type FallbackChain struct {
    Sources []*UpstreamSource
    Breakers map[string]*CircuitBreaker // ç†”æ–­å™¨ï¼ˆæ–°å¢ï¼‰
    Tracer   trace.Tracer               // é“¾è·¯è¿½è¸ªï¼ˆæ–°å¢ï¼‰
}

// SongMatchRequest æ­Œæ›²åŒ¹é…è¯·æ±‚ï¼ˆæ”¹è¿›ï¼šå¢åŠ æ­Œæ‰‹åŒ¹é…ï¼‰
type SongMatchRequest struct {
    SongID     string
    SongName   string
    ArtistName string  // æ–°å¢ï¼šæé«˜åŒ¹é…å‡†ç¡®åº¦
    RetryCount int     // æ–°å¢ï¼šé‡è¯•è®¡æ•°
}
```

**æ”¹è¿›ç‚¹ä½“ç°**:
- âœ… **ä¸‰çº§ç¼“å­˜**: L1å†…å­˜ â†’ L2 Redis â†’ L3 Staleé™çº§
- âœ… **ç¼“å­˜é¢„çƒ­**: å¯åŠ¨æ—¶åŠ è½½çƒ­ç‚¹æ•°æ®ï¼ˆbanner, çƒ­é—¨æ­Œå•ï¼‰
- âœ… **å•é£æ¨¡å¼**: ä½¿ç”¨ `singleflight` é˜²æ­¢ç¼“å­˜å‡»ç©¿
- âœ… **ç†”æ–­å™¨**: æ¯ä¸ªä¸Šæ¸¸æºç‹¬ç«‹ç†”æ–­çŠ¶æ€
- âœ… **é“¾è·¯è¿½è¸ª**: OpenTelemetryé›†æˆï¼Œå…¨é“¾è·¯å¯è§‚æµ‹
- âœ… **é€Ÿç‡é™åˆ¶**: ä¸Šæ¸¸é™æµï¼Œé˜²æ­¢è¢«å°ç¦
- âœ… **å¤šæºFallback**: QQ â†’ Joox â†’ NetEase â†’ Kugou
- âœ… **æ™ºèƒ½åŒ¹é…**: æ­Œå+æ­Œæ‰‹ååŒ¹é…ï¼Œæé«˜å‡†ç¡®åº¦
- âœ… **é‡è¯•æœºåˆ¶**: æŒ‡æ•°é€€é¿é‡è¯•

---

#### é¢†åŸŸ3: ç”¨æˆ·å†…å®¹ (User Content)
**æŠ€æœ¯æ ˆ**: Go + PostgreSQL

**å®ä½“æ¨¡å‹**:
```go
// Favorite æ”¶è—
type Favorite struct {
    ID        string
    UserID    string
    Type      FavoriteType  // song | album | artist | mv
    TargetID  string        // ç¬¬ä¸‰æ–¹ID
    DeletedAt *time.Time    // è½¯åˆ é™¤
    CreatedAt time.Time
}

// PlayHistory æ’­æ”¾å†å²ï¼ˆæ”¹è¿›ï¼šè‡ªåŠ¨æ¸…ç†ç­–ç•¥ï¼‰
type PlayHistory struct {
    ID           string
    UserID       string
    SongID       string
    SongName     string    // å†—ä½™å­˜å‚¨ï¼ˆæ–°å¢ï¼šç¦»çº¿æ˜¾ç¤ºï¼‰
    ArtistName   string
    Duration     int       // æ’­æ”¾æ—¶é•¿
    PlayedAt     time.Time
    // çº¦æŸ: æ¯ç”¨æˆ·æœ€å¤š500æ¡ï¼Œè¶…å‡ºè‡ªåŠ¨åˆ é™¤æœ€æ—©è®°å½•
}

// UserPlaylist ç”¨æˆ·æ­Œå•
type UserPlaylist struct {
    ID        string
    UserID    string
    Name      string
    CoverURL  string
    IsPublic  bool
    SongCount int        // å†—ä½™å­—æ®µï¼ˆæ–°å¢ï¼šå¿«é€ŸæŸ¥è¯¢ï¼‰
    DeletedAt *time.Time
    CreatedAt time.Time
    UpdatedAt time.Time
}

// PlaylistSong æ­Œå•-æ­Œæ›²å…³è”
type PlaylistSong struct {
    PlaylistID string
    SongID     string
    Position   int
    AddedAt    time.Time
}
```

**æ”¹è¿›ç‚¹ä½“ç°**:
- âœ… **è‡ªåŠ¨æ¸…ç†**: Cronå®šæ—¶ä»»åŠ¡ï¼Œæ¯ç”¨æˆ·ä¿ç•™æœ€æ–°500æ¡å†å²
- âœ… **å†—ä½™å­˜å‚¨**: æ’­æ”¾å†å²å­˜å‚¨æ­Œåã€æ­Œæ‰‹åï¼Œæ”¯æŒç¦»çº¿æ˜¾ç¤º
- âœ… **è½¯åˆ é™¤**: æ”¶è—å’Œæ­Œå•ä½¿ç”¨è½¯åˆ é™¤ï¼Œæ”¯æŒæ¢å¤

---

#### é¢†åŸŸ4: å®æ—¶åŒæ­¥ (Real-time Sync)
**æŠ€æœ¯æ ˆ**: Go + WebSocket + Redis Pub/Sub

**æ ¸å¿ƒç»„ä»¶**:
```go
// WSConnection WebSocketè¿æ¥ï¼ˆæ”¹è¿›ï¼šå¿ƒè·³+è¶…æ—¶ï¼‰
type WSConnection struct {
    ConnID       string
    UserID       string
    DeviceID     string
    Conn         *websocket.Conn
    LastPing     time.Time     // æ–°å¢ï¼šå¿ƒè·³æ£€æµ‹
    PingTimeout  time.Duration // æ–°å¢ï¼šè¶…æ—¶æ—¶é—´
    SendChan     chan []byte   // å‘é€é˜Ÿåˆ—
    CloseChan    chan struct{}
}

// SyncEvent åŒæ­¥äº‹ä»¶ï¼ˆæ”¹è¿›ï¼šå¢åŠ ACKæœºåˆ¶ï¼‰
type SyncEvent struct {
    ID        string    // æ¶ˆæ¯IDï¼ˆæ–°å¢ï¼šæ”¯æŒACKï¼‰
    EventType string    // favorite.added, playlist.updated, ...
    UserID    string
    Data      json.RawMessage
    AckToken  string    // æ–°å¢ï¼šå®¢æˆ·ç«¯éœ€å›å¤æ­¤token
    Timestamp time.Time
}

// OfflineMessage ç¦»çº¿æ¶ˆæ¯ï¼ˆæ–°å¢ï¼šæ¶ˆæ¯å¯é æ€§ï¼‰
type OfflineMessage struct {
    UserID    string
    Message   *SyncEvent
    CreatedAt time.Time
}

// ConnectionLimiter è¿æ¥é™åˆ¶å™¨ï¼ˆæ–°å¢ï¼šé˜²æ­¢èµ„æºè€—å°½ï¼‰
type ConnectionLimiter struct {
    MaxConnections int       // æœ€å¤§è¿æ¥æ•°ï¼ˆå¦‚10000ï¼‰
    CurrentCount   int32     // å½“å‰è¿æ¥æ•°ï¼ˆåŸå­æ“ä½œï¼‰
    Semaphore      chan struct{}
}
```

**æ”¹è¿›ç‚¹ä½“ç°**:
- âœ… **å¿ƒè·³æœºåˆ¶**: 30ç§’ä¸€æ¬¡Ping/Pongï¼Œè¶…æ—¶è‡ªåŠ¨æ–­å¼€
- âœ… **é‡è¿ç­–ç•¥**: å®¢æˆ·ç«¯æŒ‡æ•°é€€é¿é‡è¿ï¼ˆ1s â†’ 2s â†’ 4s â†’ ... â†’ 30sï¼‰
- âœ… **è¿æ¥æ•°é™åˆ¶**: æœ€å¤š10000ä¸ªå¹¶å‘è¿æ¥ï¼Œè¶…å‡ºè¿”å›503
- âœ… **ç¦»çº¿æ¶ˆæ¯é˜Ÿåˆ—**: Redis Listå­˜å‚¨ï¼Œä¸Šçº¿æ—¶æ‹‰å–
- âœ… **æ¶ˆæ¯ç¡®è®¤æœºåˆ¶**: å®¢æˆ·ç«¯ACKååˆ é™¤ç¦»çº¿æ¶ˆæ¯
- âœ… **Redis Pub/Sub**: è·¨å®ä¾‹æ¶ˆæ¯å¹¿æ’­

---

#### é¢†åŸŸ5: ç³»ç»Ÿé…ç½® (System Config)
**æŠ€æœ¯æ ˆ**: Go + Consul KV + PostgreSQL + æ–‡ä»¶é…ç½®

**ğŸ“ é…ç½®åˆ†å±‚æ¶æ„** (é‡è¦):

**1. åŸºç¡€è®¾æ–½é…ç½® (æ–‡ä»¶/ç¯å¢ƒå˜é‡)**
```yaml
# config/local.yaml - å¯åŠ¨æ—¶åŠ è½½ï¼Œä¸æ”¯æŒçƒ­æ›´æ–°
infrastructure:
  postgres:
    host: localhost
    port: 5432
    database: listen_stream
    max_connections: 100
  redis:
    addresses: [localhost:6379]
    pool_size: 50
  service:
    http_port: 8001
    grpc_port: 9001
```

**2. ä¸šåŠ¡é…ç½® (Consul KV - æ”¯æŒçƒ­æ›´æ–°)**
```
listen-stream/
â”œâ”€â”€ common/jwt_secret         # JWTç­¾åå¯†é’¥
â”œâ”€â”€ common/jwt_version        # JWTå¯†é’¥ç‰ˆæœ¬
â”œâ”€â”€ api/qq_music/base_url     # QQéŸ³ä¹APIåœ°å€
â”œâ”€â”€ api/qq_music/api_key      # APIå¯†é’¥(åŠ å¯†)
â”œâ”€â”€ sms/aliyun/access_key     # çŸ­ä¿¡é…ç½®(åŠ å¯†)
â””â”€â”€ features/token_ip_binding # åŠŸèƒ½å¼€å…³
```

**é…ç½®æ¨¡å‹ (PostgreSQLå†å²è®°å½•)**:
```go
// ConfigHistory é…ç½®å˜æ›´å†å²ï¼ˆå®¡è®¡ç”¨ï¼‰
type ConfigHistory struct {
    ID         string
    Key        string          // Consul KV key
    OldValue   []byte          // æ—§å€¼(åŠ å¯†)
    NewValue   []byte          // æ–°å€¼(åŠ å¯†)
    ChangedBy  string          // ç®¡ç†å‘˜ID
    ChangedAt  time.Time
    Version    int             // ç‰ˆæœ¬å·
    Rollbackable bool          // æ˜¯å¦å¯å›æ»š
}
```

**é…ç½®ä¸­å¿ƒæ¶æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          åº”ç”¨æœåŠ¡å¯åŠ¨æµç¨‹                        â”‚
â”‚  1. è¯»å– config/local.yaml (PostgreSQL/Redis)  â”‚
â”‚  2. è¿æ¥ Consul                                 â”‚
â”‚  3. è¯»å–ä¸šåŠ¡é…ç½®(30sç¼“å­˜)                       â”‚
â”‚  4. Watché…ç½®å˜æ›´                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Consul KV (ä¸šåŠ¡é…ç½®å­˜å‚¨)               â”‚
â”‚  â€¢ çƒ­æ›´æ–°æ”¯æŒ                                    â”‚
â”‚  â€¢ Watchæœºåˆ¶                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ ç®¡ç†å‘˜ä¿®æ”¹
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          admin-svc                              â”‚
â”‚  1. å†™å…¥Consul KV                               â”‚
â”‚  2. å†™å…¥PostgreSQLå†å²                          â”‚
â”‚  3. å‘å¸ƒRedis Pub/Subé€šçŸ¥                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ "config:changed"
                  â–¼
        æ‰€æœ‰æœåŠ¡æ¸…é™¤ç¼“å­˜ â†’ ç«‹å³ç”Ÿæ•ˆ
```

**æ”¹è¿›ç‚¹ä½“ç°**:
- âœ… **é…ç½®åˆ†å±‚**: åŸºç¡€è®¾æ–½(æ–‡ä»¶) + ä¸šåŠ¡é…ç½®(Consul)
- âœ… **çƒ­æ›´æ–°**: Consul KV + Watchæœºåˆ¶
- âœ… **ç‰ˆæœ¬æ§åˆ¶**: PostgreSQLè®°å½•æ‰€æœ‰å˜æ›´å†å²
- âœ… **å˜æ›´é€šçŸ¥**: Redis Pub/Subå®æ—¶å¹¿æ’­
- âœ… **æ•æ„ŸåŠ å¯†**: APIå¯†é’¥ã€SMSé…ç½®AES-256-GCMåŠ å¯†
- âœ… **å®¹é”™æœºåˆ¶**: Consulä¸å¯ç”¨æ—¶ä½¿ç”¨æœ¬åœ°ç¼“å­˜

---

#### é¢†åŸŸ6: ç®¡ç†ä¸å®¡è®¡ (Admin & Audit)
**æŠ€æœ¯æ ˆ**: Go + PostgreSQL + React

**å®¡è®¡æ¨¡å‹**:
```go
// AdminUser ç®¡ç†å‘˜ï¼ˆæ”¹è¿›ï¼šåŒå› ç´ è®¤è¯ï¼‰
type AdminUser struct {
    ID           string
    Username     string
    PasswordHash string          // Argon2id
    Role         AdminRole        // SUPER_ADMIN | ADMIN
    TOTPSecret   string           // 2FAå¯†é’¥ï¼ˆå¯é€‰ï¼‰
    TOTPEnabled  bool             // æ–°å¢ï¼šæ˜¯å¦å¯ç”¨2FA
    Disabled     bool
    LastLoginAt  *time.Time       // æ–°å¢ï¼šæœ€åç™»å½•æ—¶é—´
    LastLoginIP  string           // æ–°å¢ï¼šæœ€åç™»å½•IP
    CreatedAt    time.Time
    UpdatedAt    time.Time
}

// OperationLog æ“ä½œæ—¥å¿—ï¼ˆæ”¹è¿›ï¼šç»“æ„åŒ–+å‘Šè­¦ï¼‰
type OperationLog struct {
    ID          string
    AdminID     string
    Action      string           // USER_DISABLED, CONFIG_UPDATED, ...
    TargetType  string           // user | config | device
    TargetID    string
    BeforeData  json.RawMessage  // ç»“æ„åŒ–JSON
    AfterData   json.RawMessage
    RequestID   string           // æ–°å¢ï¼šå…³è”è¯·æ±‚é“¾è·¯
    IPAddress   string
    UserAgent   string
    Status      string           // success | failed
    ErrorMsg    string           // å¤±è´¥åŸå› 
    CreatedAt   time.Time
}

// DailyStats æ¯æ—¥ç»Ÿè®¡ï¼ˆæ–°å¢ï¼šå®šæ—¶èšåˆï¼‰
type DailyStats struct {
    Date            time.Time  // PK
    TotalUsers      int
    ActiveUsers     int        // å½“æ—¥æ´»è·ƒ
    NewUsers        int        // æ–°æ³¨å†Œ
    TotalFavorites  int
    TotalPlaylists  int
    TotalHistory    int
    SMSSentCount    int        // æ–°å¢ï¼šçŸ­ä¿¡å‘é€ç»Ÿè®¡
    SMSFailedCount  int
    APICallCount    int        // æ–°å¢ï¼šAPIè°ƒç”¨ç»Ÿè®¡
    ErrorRate       float64    // æ–°å¢ï¼šé”™è¯¯ç‡
}

// AnomalousActivity å¼‚å¸¸æ´»åŠ¨å‘Šè­¦ï¼ˆæ–°å¢ï¼‰
type AnomalousActivity struct {
    ID          string
    Type        string    // mass_disable | jwt_change_offhours | ...
    AdminID     string
    Description string
    Severity    string    // low | medium | high | critical
    NotificationSent bool
    CreatedAt   time.Time
}
```

**æ”¹è¿›ç‚¹ä½“ç°**:
- âœ… **æ“ä½œå®¡è®¡è¯¦æƒ…**: ç»“æ„åŒ–JSONï¼Œæ”¯æŒç²¾ç¡®æŸ¥è¯¢
- âœ… **å¼‚å¸¸æ“ä½œå‘Šè­¦**: è‡ªåŠ¨æ£€æµ‹å¯ç–‘è¡Œä¸ºï¼ˆå¤§é‡ç¦ç”¨ã€éå·¥ä½œæ—¶é—´ä¿®æ”¹é…ç½®ï¼‰
- âœ… **å®¡è®¡æ—¥å¿—å¯¼å‡º**: CSV/Excelæ ¼å¼ï¼Œæ”¯æŒåˆè§„å®¡æŸ¥
- âœ… **å®šæ—¶èšåˆ**: æ¯æ—¥å‡Œæ™¨ç»Ÿè®¡ï¼ŒDashboardç§’çº§å“åº”
- âœ… **å®æ—¶æŒ‡æ ‡**: Rediså­˜å‚¨å½“æ—¥å®æ—¶æ•°æ®
- âœ… **åŒå› ç´ è®¤è¯**: ç®¡ç†å‘˜å¯é€‰TOTP

---

## 2. æ¶æ„è®¾è®¡ï¼ˆèå…¥æ‰€æœ‰æ”¹è¿›ï¼‰

### 2.1 æœåŠ¡æ‹“æ‰‘ï¼ˆåŒ…å«æœåŠ¡æ²»ç†ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¢æˆ·ç«¯å±‚                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  Mobile   â”‚  â”‚  Desktop  â”‚  â”‚    Web    â”‚  â”‚  TV App   â”‚    â”‚
â”‚   â”‚   (Flutter)â”‚  â”‚ (Flutter) â”‚  â”‚  (React)  â”‚  â”‚(Flutter)  â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚              â”‚              â”‚              â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                  HTTPS + JWT Bearer
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æœåŠ¡ç½‘æ ¼å±‚ (å¯é€‰)                                 â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚         â”‚    Istio / Linkerd (å¯é€‰)        â”‚                      â”‚
â”‚         â”‚    - æœåŠ¡ç½‘æ ¼                     â”‚                      â”‚
â”‚         â”‚    - mTLS                        â”‚                      â”‚
â”‚         â”‚    - æµé‡æ§åˆ¶                     â”‚                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æœåŠ¡æ²»ç†å±‚ï¼ˆæ–°å¢ï¼‰                                     â”‚
â”‚                        â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   Consul (æœåŠ¡æ³¨å†Œä¸­å¿ƒ)                       â”‚ â”‚
â”‚  â”‚  â€¢ Service Registry (æœåŠ¡æ³¨å†Œä¸å‘ç°)                         â”‚ â”‚
â”‚  â”‚  â€¢ Health Check (å¥åº·æ£€æŸ¥)                                   â”‚ â”‚
â”‚  â”‚  â€¢ KV Store (é…ç½®ä¸­å¿ƒ)                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚          OpenTelemetry Collector (é“¾è·¯è¿½è¸ª)                  â”‚ â”‚
â”‚  â”‚  â€¢ Trace: åˆ†å¸ƒå¼è¿½è¸ª                                         â”‚ â”‚
â”‚  â”‚  â€¢ Metrics: æŒ‡æ ‡æ”¶é›†                                         â”‚ â”‚
â”‚  â”‚  â€¢ Logs: æ—¥å¿—æ”¶é›†                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                   â”‚                                                â”‚
â”‚                   â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  Jaeger (åˆ†å¸ƒå¼è¿½è¸ªå­˜å‚¨)                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API ç½‘å…³å±‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        proxy-svc :8002(HTTP) :9002(gRPC)                    â”‚ â”‚
â”‚  â”‚        å¯¹å¤–HTTP REST / å¯¹å†…gRPC Client                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚ Middleware Stack:                                       â”‚â”‚ â”‚
â”‚  â”‚  â”‚  1. è¯·æ±‚IDæ³¨å…¥ (X-Request-ID)                           â”‚â”‚ â”‚
â”‚  â”‚  â”‚  2. é“¾è·¯è¿½è¸ª (OpenTelemetry)                            â”‚â”‚ â”‚
â”‚  â”‚  â”‚  3. é€Ÿç‡é™åˆ¶ (IP + User åŒç»´åº¦)                         â”‚â”‚ â”‚
â”‚  â”‚  â”‚  4. JWTéªŒè¯ (æ— DBæŸ¥è¯¢ï¼ŒéªŒè¯ç­¾å+è¿‡æœŸ+ç‰ˆæœ¬)             â”‚â”‚ â”‚
â”‚  â”‚  â”‚  5. å®‰å…¨å¤´ (CORS, CSP, X-Frame-Options)                â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚ ä¸‰çº§ç¼“å­˜:                                                â”‚â”‚ â”‚
â”‚  â”‚  â”‚  L1: MemoryCache (1000æ¡, 5åˆ†é’Ÿ)                        â”‚â”‚ â”‚
â”‚  â”‚  â”‚  L2: RedisCache (å¸¸è§„TTL)                               â”‚â”‚ â”‚
â”‚  â”‚  â”‚  L3: StaleCache (é™çº§)                                  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  + SingleFlight (é˜²ç¼“å­˜å‡»ç©¿)                            â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚ ä¸Šæ¸¸ç®¡ç†:                                                â”‚â”‚ â”‚
â”‚  â”‚  â”‚  - QQ Music API (ç†”æ–­å™¨ä¿æŠ¤)                            â”‚â”‚ â”‚
â”‚  â”‚  â”‚  - Joox API (Fallback 1)                                â”‚â”‚ â”‚
â”‚  â”‚  â”‚  - NetEase API (Fallback 2)                             â”‚â”‚ â”‚
â”‚  â”‚  â”‚  - Kugou API (Fallback 3)                               â”‚â”‚ â”‚
â”‚  â”‚  â”‚  - æ¯æºç‹¬ç«‹é€Ÿç‡é™åˆ¶ (20 req/s)                           â”‚â”‚ â”‚
â”‚  â”‚  â”‚  - æŒ‡æ•°é€€é¿é‡è¯• (æœ€å¤š3æ¬¡)                                â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚     gRPCå†…éƒ¨é€šä¿¡ï¼ˆé«˜æ€§èƒ½ï¼‰    â”‚
          â”‚    Protobuf + HTTP/2        â”‚
          â”‚              â”‚              â”‚
          â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä¸šåŠ¡æœåŠ¡å±‚                                       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  auth-svc    â”‚  â”‚  user-svc    â”‚  â”‚  sync-svc    â”‚             â”‚
â”‚  â”‚ :8001(HTTP)  â”‚  â”‚ :8003(HTTP)  â”‚  â”‚ :8004(HTTP)  â”‚             â”‚
â”‚  â”‚ :9001(gRPC)  â”‚  â”‚ :9003(gRPC)  â”‚  â”‚ :9004(gRPC)  â”‚             â”‚
â”‚  â”‚    :8001     â”‚  â”‚    :8003     â”‚  â”‚    :8004     â”‚             â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚             â”‚
â”‚  â”‚ â€¢ æ‰‹æœºç™»å½•   â”‚  â”‚ â€¢ æ”¶è—ç®¡ç†   â”‚  â”‚ â€¢ WebSocket  â”‚             â”‚
â”‚  â”‚ â€¢ JWTç­¾å‘    â”‚  â”‚ â€¢ æ­Œå•ç®¡ç†   â”‚  â”‚ â€¢ å®æ—¶æ¨é€   â”‚             â”‚
â”‚  â”‚ â€¢ è®¾å¤‡ç®¡ç†   â”‚  â”‚ â€¢ æ’­æ”¾å†å²   â”‚  â”‚ â€¢ ç¦»çº¿æ¶ˆæ¯   â”‚             â”‚
â”‚  â”‚ â€¢ å¤šå‚å•†SMS  â”‚  â”‚ â€¢ Cronæ¸…ç†   â”‚  â”‚ â€¢ å¿ƒè·³æ£€æµ‹   â”‚             â”‚
â”‚  â”‚ â€¢ Tokenç‰ˆæœ¬  â”‚  â”‚              â”‚  â”‚ â€¢ è¿æ¥é™åˆ¶   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                 â”‚                 â”‚                      â”‚
â”‚         â”‚  ConsulæœåŠ¡å‘ç° â”‚                 â”‚                      â”‚
â”‚         â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚         â”‚                 â”‚                                        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                                     â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              å…±äº«æ•°æ®å±‚                                      â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚   PostgreSQL       â”‚  â”‚   Redis Cluster    â”‚            â”‚   â”‚
â”‚  â”‚  â”‚     :5432          â”‚  â”‚     :6379          â”‚            â”‚   â”‚
â”‚  â”‚  â”‚                    â”‚  â”‚                    â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ ä¸»ä»å¤åˆ¶         â”‚  â”‚ â€¢ ç¼“å­˜             â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ pgBouncerè¿æ¥æ±   â”‚  â”‚ â€¢ RTå­˜å‚¨           â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ è‡ªåŠ¨å¤‡ä»½         â”‚  â”‚ â€¢ Pub/Sub          â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ æ…¢æŸ¥è¯¢ç›‘æ§       â”‚  â”‚ â€¢ ç¦»çº¿æ¶ˆæ¯é˜Ÿåˆ—     â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ (ç‹¬ç«‹ç½‘ç»œ)
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç®¡ç†ç«¯å±‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                admin-svc :8005                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ ç³»ç»Ÿåˆå§‹åŒ–                                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ é…ç½®ç®¡ç† (Consul + PostgreSQLåŒå­˜å‚¨)              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ ç”¨æˆ·ç®¡ç†                                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ å®¡è®¡æ—¥å¿— (ç»“æ„åŒ– + å¼‚å¸¸å‘Šè­¦)                       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ æ•°æ®ç»Ÿè®¡ (å®šæ—¶èšåˆ + å®æ—¶æŒ‡æ ‡)                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ åŒå› ç´ è®¤è¯ (TOTP)                                  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¯è§‚æµ‹æ€§å¹³å°ï¼ˆæ–°å¢ï¼‰                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Prometheus  â”‚  â”‚    Grafana   â”‚  â”‚   ELK Stack  â”‚             â”‚
â”‚  â”‚  (æŒ‡æ ‡æ”¶é›†)  â”‚  â”‚   (å¯è§†åŒ–)   â”‚  â”‚   (æ—¥å¿—åˆ†æ) â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Jaeger     â”‚  â”‚ AlertManager â”‚  â”‚   PagerDuty  â”‚             â”‚
â”‚  â”‚ (é“¾è·¯è¿½è¸ª)   â”‚  â”‚  (å‘Šè­¦ç®¡ç†)  â”‚  â”‚  (å€¼ç­é€šçŸ¥)  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å…³é”®æ”¹è¿›ç‚¹å¯¹ç…§è¡¨

| æ”¹è¿›ç±»åˆ« | åŸé—®é¢˜ | æ–°æ¶æ„è§£å†³æ–¹æ¡ˆ | å¯¹åº”ç»„ä»¶ |
|---------|--------|---------------|---------|
| **æœåŠ¡æ²»ç†** | æ— æœåŠ¡æ³¨å†Œ | ConsulæœåŠ¡æ³¨å†Œä¸å‘ç° | Consul |
| | æ— ç†”æ–­ä¿æŠ¤ | æ¯ä¸ªä¸Šæ¸¸æºç‹¬ç«‹ç†”æ–­å™¨ | proxy-svc/CircuitBreaker |
| | æ— é“¾è·¯è¿½è¸ª | OpenTelemetryå…¨é“¾è·¯è¿½è¸ª | OTel Collector + Jaeger |
| **ç¼“å­˜ä¼˜åŒ–** | å•å±‚ç¼“å­˜ | ä¸‰çº§ç¼“å­˜ï¼ˆå†…å­˜+Redis+Staleï¼‰ | proxy-svc/CacheLayer |
| | æ— ç¼“å­˜é¢„çƒ­ | å¯åŠ¨æ—¶é¢„åŠ è½½çƒ­ç‚¹æ•°æ® | proxy-svc/WarmupService |
| | ç¼“å­˜å‡»ç©¿ | SingleFlighté˜²å¹¶å‘å‡»ç©¿ | proxy-svc/singleflight |
| **é…ç½®ç®¡ç†** | é…ç½®åˆ†æ•£ | Consul KVç»Ÿä¸€é…ç½®ä¸­å¿ƒ | Consul + ConfigService |
| | æ— ç‰ˆæœ¬æ§åˆ¶ | é…ç½®ç‰ˆæœ¬å·+å†å²è®°å½• | SystemConfig.Version |
| | å˜æ›´å»¶è¿Ÿ | Redis Pub/Subå®æ—¶æ¨é€ | ConfigChangeNotification |
| **æ’­æ”¾ä¼˜åŒ–** | åŒ¹é…ä¸å‡† | æ­Œå+æ­Œæ‰‹ååŒé‡åŒ¹é… | SongMatchRequest |
| | æ— é‡è¯• | æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰ | proxy-svc/RetryLogic |
| | å•ä¸€æº | 4æºFallbacké“¾ï¼ˆQQâ†’Jooxâ†’NetEaseâ†’Kugouï¼‰ | FallbackChain |
| **WebSocket** | æ— å¿ƒè·³ | 30ç§’å¿ƒè·³+è¶…æ—¶æ£€æµ‹ | WSConnection.Heartbeat |
| | è¿æ¥æ³„æ¼ | è¿æ¥æ•°é™åˆ¶ï¼ˆ10000ï¼‰ | ConnectionLimiter |
| | æ¶ˆæ¯ä¸¢å¤± | ç¦»çº¿æ¶ˆæ¯é˜Ÿåˆ—+ACKæœºåˆ¶ | OfflineMessage + AckToken |
| **SMSä¼˜åŒ–** | å•å‚å•† | å¤šå‚å•†Fallbackï¼ˆé˜¿é‡Œâ†’è…¾è®¯â†’Twilioï¼‰ | SMSService.FallbackChain |
| | æ— ç»Ÿè®¡ | SMSå‘é€è®°å½•è¡¨ | SMSRecord |
| **Tokenå®‰å…¨** | æ— ç‰ˆæœ¬æ§åˆ¶ | Tokenç‰ˆæœ¬å·ï¼Œæ”¯æŒå…¨å±€æ’¤é”€ | User.TokenVersion |
| | æ— IPç»‘å®š | å¯é€‰ä¸¥æ ¼æ¨¡å¼ï¼ŒTokenç»‘å®šIP | JWT.Claims.ClientIP |
| | æ— æŒ‡çº¹ | è®¾å¤‡æŒ‡çº¹æ£€æµ‹å¼‚å¸¸ç™»å½• | Device.Fingerprint |
| **å®¡è®¡å¢å¼º** | ç®€å•æ—¥å¿— | ç»“æ„åŒ–JSON+RequestID | OperationLog.RequestID |
| | æ— å‘Šè­¦ | å¼‚å¸¸è¡Œä¸ºè‡ªåŠ¨æ£€æµ‹ | AnomalousActivity |
| | æ— å¯¼å‡º | CSV/Excelå¯¼å‡ºåŠŸèƒ½ | admin-svc/ExportHandler |
| **ç»Ÿè®¡ä¼˜åŒ–** | å®æ—¶æŸ¥è¯¢æ…¢ | å®šæ—¶èšåˆ+é¢„è®¡ç®—è¡¨ | DailyStats + CronJob |
| | æ— å®æ—¶æŒ‡æ ‡ | Rediså­˜å‚¨å½“æ—¥æŒ‡æ ‡ | daily:stats:{metric} |
| **é€Ÿç‡é™åˆ¶** | æ— é™æµ | IP+UseråŒç»´åº¦é™æµ | RateLimiter (å…¨å±€+ç”¨æˆ·) |
| | ä¸Šæ¸¸æ— é™åˆ¶ | æ¯æºç‹¬ç«‹é€Ÿç‡é™åˆ¶ï¼ˆ20 req/sï¼‰ | UpstreamSource.RateLimiter |
| **å®‰å…¨å¢å¼º** | æ— 2FA | ç®¡ç†å‘˜å¯é€‰TOTP | AdminUser.TOTPSecret |
| | æ—¥å¿—æ•æ„Ÿ | è‡ªåŠ¨è„±æ•ï¼ˆæ‰‹æœºå·ã€Tokenï¼‰ | logger.MaskSensitive |

---

## 3. æŠ€æœ¯é€‰å‹

### 3.1 åç«¯æœåŠ¡æŠ€æœ¯æ ˆ

```yaml
ç¼–ç¨‹è¯­è¨€:
  ä¸»è¯­è¨€: Go 1.23.0
  åŸå› : é«˜æ€§èƒ½ã€å¹¶å‘å‹å¥½ã€éƒ¨ç½²ç®€å•

Webæ¡†æ¶:
  æ¡†æ¶: Gin 1.10.0
  åŸå› : è½»é‡ã€æ€§èƒ½ä¼˜å¼‚ã€ç¤¾åŒºæ´»è·ƒ

RPCæ¡†æ¶:
  æ¡†æ¶: gRPC 1.60.0
  åè®®: Protocol Buffers v3
  ç”¨é€”: æœåŠ¡é—´å†…éƒ¨é€šä¿¡ï¼ˆé«˜æ€§èƒ½ï¼‰
  ä¼˜åŠ¿:
    - æ€§èƒ½ä¼˜å¼‚ï¼ˆProtobuf + HTTP/2ï¼‰
    - ç±»å‹å®‰å…¨ï¼ˆè‡ªåŠ¨ç”Ÿæˆä»£ç ï¼‰
    - æµå¼ä¼ è¾“ï¼ˆåŒå‘æµæ”¯æŒï¼‰
    - è¿æ¥å¤ç”¨ï¼ˆHTTP/2å¤šè·¯å¤ç”¨ï¼‰
  åº“:
    - google.golang.org/grpc
    - google.golang.org/protobuf
  è¯´æ˜: å®¢æˆ·ç«¯â†’æœåŠ¡ç«¯ç”¨HTTP RESTï¼ŒæœåŠ¡é—´ç”¨gRPC

æ•°æ®åº“:
  ä¸»åº“: PostgreSQL 15
    - ä¸»ä»å¤åˆ¶ï¼ˆ1ä¸»2ä»ï¼‰
    - pgBouncerè¿æ¥æ± 
    - TimescaleDBæ‰©å±•ï¼ˆæ—¶åºæ•°æ®ï¼‰
  ç¼“å­˜: Redis 7 Cluster
    - 3ä¸»3ä»é…ç½®
    - æŒä¹…åŒ–: AOF + RDB
  
æ¶ˆæ¯é˜Ÿåˆ—:
  æ–¹æ¡ˆ: Redis Pub/Sub
  å¤‡é€‰: NATSï¼ˆå¦‚éœ€æ›´å¼ºæ¶ˆæ¯ä¿è¯ï¼‰

æœåŠ¡æ³¨å†Œ:
  æ–¹æ¡ˆ: Consul 1.17
  åŠŸèƒ½:
    - Service Registry
    - Health Check
    - KV Store (é…ç½®ä¸­å¿ƒ)
    - DNSé›†æˆ

é“¾è·¯è¿½è¸ª:
  æ”¶é›†: OpenTelemetry SDK
  å­˜å‚¨: Jaeger
  åè®®: OTLP

ç†”æ–­å™¨:
  åº“: sony/gobreaker
  é…ç½®: 5æ¬¡å¤±è´¥è§¦å‘ï¼Œ30ç§’åŠå¼€

ç¼“å­˜å‡»ç©¿é˜²æŠ¤:
  åº“: golang.org/x/sync/singleflight

é€Ÿç‡é™åˆ¶:
  åº“: uber-go/ratelimit (ä¸Šæ¸¸)
  åº“: ulule/limiter (ç”¨æˆ·)

WebSocket:
  åº“: gorilla/websocket

è®¤è¯:
  JWT: golang-jwt/jwt/v5
  å¯†ç å“ˆå¸Œ: golang.org/x/crypto/argon2
  2FA: pquerna/otp (TOTP)

æ—¥å¿—:
  åº“: uber-go/zap
  æ ¼å¼: JSONç»“æ„åŒ–
  è¾“å‡º: Stdout + Elasticsearch

æŒ‡æ ‡:
  åº“: prometheus/client_golang
  å¯¼å‡º: /metrics endpoint

é…ç½®:
  åº“: spf13/viper
  æ¥æº: ç¯å¢ƒå˜é‡ + Consul KV

æ•°æ®åº“ORM:
  æ–¹æ¡ˆ: sqlc (ä»£ç ç”Ÿæˆ)
  åŸå› : ç±»å‹å®‰å…¨ã€é›¶åå°„ã€é«˜æ€§èƒ½

æ•°æ®åº“è¿ç§»:
  å·¥å…·: golang-migrate/migrate

æµ‹è¯•:
  å•å…ƒ: testing + testify/assert
  Mock: golang/mock
  é›†æˆ: testcontainers-go
```

### 3.2 å®¢æˆ·ç«¯æŠ€æœ¯æ ˆ

```yaml
ç§»åŠ¨/æ¡Œé¢ç«¯:
  æ¡†æ¶: Flutter 3.22.0+
  è¯­è¨€: Dart 3.3.0+
  
çŠ¶æ€ç®¡ç†:
  åº“: riverpod 2.6.1
  åŸå› : ç¼–è¯‘æ—¶å®‰å…¨ã€å¯æµ‹è¯•

ç½‘ç»œ:
  åº“: dio 5.7.0
  æ‹¦æˆªå™¨:
    - JWTè‡ªåŠ¨åˆ·æ–°
    - è¯·æ±‚é‡è¯•
    - æ—¥å¿—è®°å½•

éŸ³é¢‘:
  æ’­æ”¾: just_audio 0.9.42
  åå°: audio_service 0.18.15

WebSocket:
  åº“: web_socket_channel 3.0.1
  
æœ¬åœ°å­˜å‚¨:
  Token: flutter_secure_storage
  ç¼“å­˜: sqflite (ETag)

è·¯ç”±:
  åº“: go_router 14.6.2

UI:
  åº“: åŸç”ŸMaterial + è‡ªå®šä¹‰ç»„ä»¶
  å“åº”å¼: responsive_framework
```

### 3.3 ç®¡ç†åå°æŠ€æœ¯æ ˆ

```yaml
å‰ç«¯æ¡†æ¶:
  åº“: React 19.0.0
  æ„å»º: Vite 6.0.11
  è¯­è¨€: TypeScript 5.7.3

çŠ¶æ€ç®¡ç†:
  å…¨å±€: Zustand 5.0.3
  æœåŠ¡ç«¯: TanStack Query 5.65.1

UIåº“:
  ç»„ä»¶: Radix UI (headless)
  æ ·å¼: Tailwind CSS 4.0.6
  å›¾è¡¨: Recharts 2.15.0

è·¯ç”±:
  åº“: React Router 7.1.3

HTTP:
  åº“: Axios 1.7.9
  æ‹¦æˆªå™¨: JWTè‡ªåŠ¨åˆ·æ–°

è¡¨å•:
  åº“: React Hook Form + Zod
```

### 3.4 åŸºç¡€è®¾æ–½æŠ€æœ¯æ ˆ

```yaml
å®¹å™¨åŒ–:
  è¿è¡Œæ—¶: Docker 24+
  ç¼–æ’: Kubernetes 1.28+
  é•œåƒ: Alpine Linux (æœ€å°åŒ–)

ç›‘æ§:
  æŒ‡æ ‡: Prometheus + Grafana
  æ—¥å¿—: ELK (Elasticsearch + Logstash + Kibana)
  è¿½è¸ª: Jaeger
  å‘Šè­¦: AlertManager + PagerDuty

CI/CD:
  å·¥å…·: GitHub Actions
  æµç¨‹:
    1. ä»£ç æ¨é€ â†’ è‡ªåŠ¨æµ‹è¯•
    2. æµ‹è¯•é€šè¿‡ â†’ æ„å»ºé•œåƒ
    3. è‡ªåŠ¨éƒ¨ç½²åˆ° Staging
    4. æ‰‹åŠ¨å®¡æ‰¹ â†’ ç”Ÿäº§å‘å¸ƒ

è´Ÿè½½å‡è¡¡:
  å·¥å…·: Nginx / Kubernetes Ingress
  åŠŸèƒ½:
    - SSLç»ˆæ­¢
    - HTTP/2
    - é€Ÿç‡é™åˆ¶
    - é»‘åå•

æœåŠ¡ç½‘æ ¼ï¼ˆå¯é€‰ï¼‰:
  å·¥å…·: Istio / Linkerd
  åŠŸèƒ½:
    - mTLS
    - æµé‡ç®¡ç†
    - ç†”æ–­
    - é‡è¯•

å¤‡ä»½:
  æ•°æ®åº“: æ¯æ—¥å…¨é‡ + WALå½’æ¡£
  Redis: RDBæ¯å°æ—¶ + AOFå®æ—¶
  å¯¹è±¡å­˜å‚¨: ç‰ˆæœ¬æ§åˆ¶

å®‰å…¨:
  TLS: Let's Encryptè‡ªåŠ¨ç»­æœŸ
  WAF: Cloudflare / AWS WAF
  å¯†é’¥: Vault / AWS Secrets Manager
```

---

## 4. å®ç°è·¯çº¿å›¾

### é˜¶æ®µ1: åŸºç¡€è®¾æ–½ï¼ˆç¬¬1-2å‘¨ï¼‰

#### æ­¥éª¤0: Protobufæ¥å£å®šä¹‰ + gRPCå°è£… â­ï¸ æ–°å¢
**æ–‡ä»¶**: `server/shared/proto/` + `server/shared/pkg/grpc/`

**ç›®æ ‡**: å»ºç«‹é«˜æ€§èƒ½æœåŠ¡é—´é€šä¿¡åŸºç¡€è®¾æ–½

**æ ¸å¿ƒå†…å®¹**:
1. **Protobufå®šä¹‰**:
   - `auth/v1/auth.proto`: è®¤è¯æœåŠ¡(VerifyToken, RefreshToken, RevokeToken, RevokeDevice)
   - `user/v1/user.proto`: ç”¨æˆ·å†…å®¹æœåŠ¡(æ”¶è—ã€æ­Œå•ã€å†å²)
**âš ï¸ é‡è¦**: æ­¥éª¤0ä¸æ¶‰åŠé…ç½®ä¼ é€’ï¼Œé…ç½®é€šè¿‡Consul KV + æ–‡ä»¶ç®¡ç†

   - `sync/v1/sync.proto`: åŒæ­¥æœåŠ¡(TriggerSync, GetOfflineMessages)
   - `admin/v1/admin.proto`: ç®¡ç†æœåŠ¡æ¥å£

2. **gRPCå·¥å…·åº“**:
   - `client.go`: å®¢ï¿½ç«¯å°è£…(è¿æ¥æ± ã€é‡è¯•ã€æœåŠ¡å‘ç°)
   - `server.go`: æœåŠ¡ç«¯å°è£…(å¥åº·æ£€æŸ¥ã€ä¼˜é›…å…³é—­)
   - `interceptor/`: æ‹¦æˆªå™¨(æ—¥å¿—ã€è¿½è¸ªã€æ¢å¤ã€è®¤è¯ã€é™æµ)
   - `errors.go`: é”™è¯¯è½¬æ¢(gRPC Status â†” ä¸šåŠ¡é”™è¯¯)

**æ¶æ„å†³ç­–**:
- å®¢æˆ·ç«¯â†’æœåŠ¡ç«¯: HTTP REST(æ˜“ç”¨æ€§)
- æœåŠ¡é—´: gRPC(æ€§èƒ½ä¼˜å…ˆï¼Œå»¶è¿Ÿé™ä½10x)
- åŒç«¯å£: HTTP :800x + gRPC :900x

**å®Œæˆæ ‡å‡†**:
- [ ] æ‰€æœ‰.protoæ–‡ä»¶å®šä¹‰å®Œæˆå¹¶ç”ŸæˆGoä»£ç 
- [ ] gRPCå·¥å…·åº“å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- [ ] æ€§èƒ½æµ‹è¯•: gRPCè°ƒç”¨P99å»¶è¿Ÿ < 5ms
- [ ] Mockæµ‹è¯•: å®¢æˆ·ç«¯-æœåŠ¡ç«¯é€šä¿¡æ­£å¸¸

**è¯¦ç»†è®¾è®¡**: è§ [step0-grpc-design.md](step0-grpc-design.md)

---

#### æ­¥éª¤1: å…±äº«åº“ - åŠ å¯†å·¥å…·
**æ–‡ä»¶**: `server/shared/pkg/crypto/`
- `aes.go`: AES-256-GCMåŠ å¯†è§£å¯†
- `hash.go`: Argon2idå¯†ç å“ˆå¸Œ
- `keygen.go`: å¯†é’¥ç”Ÿæˆ
- `mask.go`: æ•æ„Ÿæ•°æ®è„±æ•ï¼ˆæ–°å¢ï¼‰

**æµ‹è¯•æ ‡å‡†**:
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%
- [ ] åŠ å¯†åè§£å¯†è¿˜åŸæˆåŠŸ
- [ ] å¯†ç å“ˆå¸Œæ—¶é—´ < 500ms

#### æ­¥éª¤2: å…±äº«åº“ - é…ç½®æœåŠ¡ â­ï¸ ä¼˜å…ˆçº§æå‡
**æ–‡ä»¶**: `server/shared/pkg/config/`

**ğŸ“ é…ç½®åˆ†å±‚ç­–ç•¥**:
1. **åŸºç¡€è®¾æ–½é…ç½®** (æ–‡ä»¶/ç¯å¢ƒå˜é‡): PostgreSQLã€Redisè¿æ¥ä¿¡æ¯
2. **ä¸šåŠ¡é…ç½®** (Consul KV): JWTå¯†é’¥ã€APIå¯†é’¥ã€SMSé…ç½®ã€åŠŸèƒ½å¼€å…³

**æ ¸å¿ƒæ–‡ä»¶**:
- `file.go`: åŠ è½½config/local.yaml (PostgreSQL/Redisé…ç½®)
- `consul.go`: Consul KVé…ç½®æœåŠ¡(ä¸šåŠ¡é…ç½®)
- `cache.go`: 30ç§’æœ¬åœ°ç¼“å­˜
- `watcher.go`: é…ç½®å˜æ›´ç›‘å¬ï¼ˆæ–°å¢ï¼‰
- `types.go`: é…ç½®ç»“æ„å®šä¹‰
- `validator.go`: é…ç½®éªŒè¯

**Consul KVç»“æ„**:
```
listen-stream/
â”œâ”€â”€ common/              # å…±äº«é…ç½®
â”‚   â”œâ”€â”€ jwt_secret
â”‚   â”œâ”€â”€ jwt_version
â”‚   â””â”€â”€ aes_key
â”œâ”€â”€ api/                 # ç¬¬ä¸‰æ–¹API
â”‚   â”œâ”€â”€ qq_music/
â”‚   â”œâ”€â”€ joox/
â”‚   â””â”€â”€ netease/
â”œâ”€â”€ sms/                 # çŸ­ä¿¡é…ç½®
â”‚   â”œâ”€â”€ aliyun/
â”‚   â””â”€â”€ tencent/
â””â”€â”€ features/            # åŠŸèƒ½å¼€å…³
```

**é…ç½®å˜æ›´æµç¨‹**:
```
ç®¡ç†å‘˜ä¿®æ”¹é…ç½® â†’ Consul KV + PostgreSQLå†å²
    â†“
å‘å¸ƒ Redis Pub/Sub é€šçŸ¥
    â†“
æ‰€æœ‰æœåŠ¡æ¸…é™¤ç¼“å­˜ â†’ ç«‹å³ç”Ÿæ•ˆ
```

**æµ‹è¯•æ ‡å‡†**:
- [ ] åŸºç¡€è®¾æ–½é…ç½®ä»æ–‡ä»¶åŠ è½½æˆåŠŸ
- [ ] ä¸šåŠ¡é…ç½®ä»Consulè¯»å–æˆåŠŸ
- [ ] é…ç½®å˜æ›´é€šçŸ¥<1ç§’ç”Ÿæ•ˆ
- [ ] æœ¬åœ°ç¼“å­˜30ç§’TTLæ­£å¸¸å·¥ä½œ
- [ ] æ•æ„Ÿé…ç½®åŠ å¯†å­˜å‚¨

**è¯¦ç»†è®¾è®¡**: è§ [config-management-strategy.md](config-management-strategy.md)

#### æ­¥éª¤3: å…±äº«åº“ - æ—¥å¿—å·¥å…·
**æ–‡ä»¶**: `server/shared/pkg/logger/`
- `zap.go`: Zapå°è£…
- `otel.go`: OpenTelemetryé›†æˆï¼ˆæ–°å¢ï¼‰
- `mask.go`: è‡ªåŠ¨è„±æ•å­—æ®µ

**æµ‹è¯•æ ‡å‡†**:
- [ ] ç»“æ„åŒ–JSONè¾“å‡º
- [ ] æ‰‹æœºå·è‡ªåŠ¨è„±æ•
- [ ] TraceIDè‡ªåŠ¨æ³¨å…¥

#### æ­¥éª¤4: å…±äº«åº“ - æ•°æ®åº“å°è£…
**æ–‡ä»¶**: `server/shared/pkg/db/`
- `postgres.go`: PostgreSQLè¿æ¥æ± 
- `migration.go`: è¿ç§»å·¥å…·
- `health.go`: å¥åº·æ£€æŸ¥

**æµ‹è¯•æ ‡å‡†**:
- [ ] ä¸»ä»è¯»å†™åˆ†ç¦»
- [ ] è¿æ¥æ± æ­£å¸¸å·¥ä½œ

#### æ­¥éª¤5: å…±äº«åº“ - Rediså°è£…
**æ–‡ä»¶**: `server/shared/pkg/redis/`
- `client.go`: Rediså®¢æˆ·ç«¯
- `pubsub.go`: Pub/Subå°è£…
- `keys.go`: é”®å‘½åè§„èŒƒ
- `singleflight.go`: ç¼“å­˜å‡»ç©¿ä¿æŠ¤ï¼ˆæ–°å¢ï¼‰

**æµ‹è¯•æ ‡å‡†**:
- [ ] Clusteræ¨¡å¼æ”¯æŒ
- [ ] Pub/Subæ¶ˆæ¯ä¼ é€’æ­£å¸¸

#### æ­¥éª¤6: å…±äº«åº“ - å…¶ä»–å·¥å…·
**æ–‡ä»¶**:
- `server/shared/pkg/errors/`: ç»Ÿä¸€é”™è¯¯å®šä¹‰
- `server/shared/pkg/httputil/`: HTTPå·¥å…·ï¼ˆRequestIDã€å“åº”æ ¼å¼ï¼‰
- `server/shared/pkg/jwt/`: JWTå·¥å…·
- `server/shared/pkg/telemetry/`: OpenTelemetryå°è£…ï¼ˆæ–°å¢ï¼‰
- `server/shared/pkg/breaker/`: ç†”æ–­å™¨å°è£…ï¼ˆæ–°å¢ï¼‰
- `server/shared/pkg/limiter/`: é€Ÿç‡é™åˆ¶ï¼ˆæ–°å¢ï¼‰

---

### é˜¶æ®µ2: è®¤è¯æœåŠ¡ï¼ˆç¬¬3-4å‘¨ï¼‰

#### æ­¥éª¤7: auth-svc - é¢†åŸŸå±‚
**æ–‡ä»¶**: `server/services/auth-svc/internal/domain/`
- `user.go`: Userå®ä½“ + TokenVersionå­—æ®µ
- `device.go`: Deviceå®ä½“ + Fingerprintå­—æ®µ
- `sms.go`: SMSVerificationå®ä½“
- `sms_record.go`: SMSRecordå®ä½“ï¼ˆæ–°å¢ï¼‰

#### æ­¥éª¤8: auth-svc - ä»“å‚¨å±‚
**æ–‡ä»¶**: `server/services/auth-svc/internal/repository/`
- `user_repo.go`: ç”¨æˆ·æ•°æ®è®¿é—®
- `device_repo.go`: è®¾å¤‡ç®¡ç†ï¼ˆæœ€å¤š5å°é™åˆ¶ï¼‰
- `sms_repo.go`: çŸ­ä¿¡è®°å½•
- SQLæ–‡ä»¶: `internal/repository/queries/` (sqlcç”Ÿæˆ)

#### æ­¥éª¤9: auth-svc - SMSæœåŠ¡ï¼ˆå¤šå‚å•†ï¼‰
**æ–‡ä»¶**: `server/services/auth-svc/internal/service/sms/`
- `provider.go`: SMSæä¾›å•†æ¥å£
- `aliyun.go`: é˜¿é‡Œäº‘SMS
- `tencent.go`: è…¾è®¯äº‘SMS
- `twilio.go`: Twilio SMSï¼ˆæ–°å¢ï¼‰
- `fallback.go`: Fallbacké“¾é€»è¾‘ï¼ˆæ–°å¢ï¼‰
- `stats.go`: å‘é€ç»Ÿè®¡ï¼ˆæ–°å¢ï¼‰

**æ”¹è¿›ç‚¹**:
- æ”¯æŒ3ä¸ªSMSæä¾›å•†
- è‡ªåŠ¨Fallback
- è®°å½•æ‰€æœ‰å‘é€æ—¥å¿—

#### æ­¥éª¤10: auth-svc - JWTæœåŠ¡ï¼ˆç‰ˆæœ¬æ§åˆ¶ï¼‰
**æ–‡ä»¶**: `server/services/auth-svc/internal/service/jwt_service.go`
- ç­¾å‘Tokenæ—¶æ³¨å…¥TokenVersion
- éªŒè¯Tokenæ—¶æ£€æŸ¥ç‰ˆæœ¬å·
- æ”¯æŒIPç»‘å®šï¼ˆå¯é€‰ï¼‰

#### æ­¥éª¤11: auth-svc - è®¾å¤‡ç®¡ç†æœåŠ¡
**æ–‡ä»¶**: `server/services/auth-svc/internal/service/device_service.go`
- è®¾å¤‡æ³¨å†Œï¼ˆç”ŸæˆæŒ‡çº¹ï¼‰
- è®¾å¤‡é™åˆ¶ï¼ˆæœ€å¤š5å°ï¼‰
- å¼‚å¸¸æ£€æµ‹ï¼ˆæŒ‡çº¹çªå˜ï¼‰

#### æ­¥éª¤12: auth-svc - gRPCæœåŠ¡å®ç° + HTTPå¤„ç†å±‚
**gRPCæœåŠ¡** (å†…éƒ¨è°ƒç”¨ - é«˜æ€§èƒ½):
- `internal/grpc/auth_server.go`: å®ç°AuthServiceæ¥å£
  - `VerifyToken()`: TokenéªŒè¯ï¼ˆproxy-svcé«˜é¢‘è°ƒç”¨ï¼‰
  - `RefreshToken()`: Tokenåˆ·æ–°
  - `RevokeToken()`: æ’¤é”€Token
  - `RevokeDevice()`: è¸¢å‡ºè®¾å¤‡

**HTTPå¤„ç†å±‚** (å®¢æˆ·ç«¯è°ƒç”¨):
- `internal/handler/login_handler.go`: å‘é€éªŒè¯ç  + éªŒè¯ç™»å½•
- `internal/handler/device_handler.go`: è®¾å¤‡åˆ—è¡¨ï¼ˆæŸ¥è¯¢ç”¨ï¼‰

#### æ­¥éª¤13: auth-svc - ä¸­é—´ä»¶
**æ–‡ä»¶**: `server/servicåŒç«¯å£å¯åŠ¨ + æœåŠ¡æ³¨å†Œ
**æ–‡ä»¶**: `server/services/auth-svc/cmd/main.go`
- HTTPæœåŠ¡å™¨(:8001) - å®¢æˆ·ç«¯æ¥å£
- gRPCæœåŠ¡å™¨(:9001) - å†…éƒ¨æ¥å£
- æ³¨å†Œåˆ°Consul(ä¸¤ä¸ªç«¯å£)
- å¥åº·æ£€æŸ¥: HTTP `/health` + gRPC `grpc.health.v1.Health`
- ä¼˜é›…å…³é—­(ç­‰å¾…è¯·æ±‚å®Œæˆ)
#### æ­¥éª¤14: auth-svc - æœåŠ¡æ³¨å†Œ
**æ–‡ä»¶**: `server/services/auth-svc/cmd/main.go`
- å¯åŠ¨æ—¶æ³¨å†Œåˆ°Consul
- å¥åº·æ£€æŸ¥ç«¯ç‚¹: `/health`
- ä¼˜é›…å…³é—­

---

### é˜¶æ®µ3: APIç½‘å…³ï¼ˆç¬¬5å‘¨ï¼‰

#### æ­¥éª¤15: proxy-svc - ä¸‰çº§ç¼“å­˜
**æ–‡ä»¶**: `server/services/proxy-svc/internal/cache/`
- `layer.go`: ç¼“å­˜åˆ†å±‚æŠ½è±¡
- `memory.go`: L1å†…å­˜ç¼“å­˜ï¼ˆLRU, 1000æ¡ï¼‰
- `redis.go`: L2 Redisç¼“å­˜
- `stale.go`: L3 é™çº§ç¼“å­˜
- `singleflight.go`: ç¼“å­˜å‡»ç©¿ä¿æŠ¤
- `warmup.go`: é¢„çƒ­é€»è¾‘ï¼ˆæ–°å¢ï¼‰

**æ”¹è¿›ç‚¹**:
- ä¸‰çº§ç¼“å­˜ä¸²è”
- å¯åŠ¨æ—¶é¢„åŠ è½½çƒ­ç‚¹æ•°æ®ï¼ˆbannerã€çƒ­é—¨æ­Œå•ï¼‰
- SingleFlighté˜²æ­¢ç¼“å­˜å‡»ç©¿

#### æ­¥éª¤16: proxy-svc - ä¸Šæ¸¸å®¢æˆ·ç«¯ï¼ˆç†”æ–­+é‡è¯•ï¼‰
**æ–‡ä»¶**: `server/services/proxy-svc/internal/upstream/`
- `client.go`: HTTPå®¢æˆ·ç«¯åŸºç±»
- `qq_music.go`: QQ Music API
- `breaker.go`: ç†”æ–­å™¨é›†æˆï¼ˆæ–°å¢ï¼‰
- `retry.go`: æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆæ–°å¢ï¼‰
- `rate_limiter.go`: ä¸Šæ¸¸é€Ÿç‡é™åˆ¶ï¼ˆæ–°å¢ï¼‰

**æ”¹è¿›ç‚¹**:
- æ¯ä¸ªä¸Šæ¸¸ç‹¬ç«‹ç†”æ–­å™¨ï¼ˆ5æ¬¡å¤±è´¥è§¦å‘ï¼‰
- æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- é€Ÿç‡é™åˆ¶ï¼ˆ20 req/s peræºï¼‰

#### æ­¥éª¤17: proxy-svc - Fallbacké“¾ï¼ˆ4æºï¼‰
**æ–‡ä»¶**: `server/services/proxy-svc/internal/handler/`
- `song_handler.go`: æ’­æ”¾URLè·å–
  - æ™ºèƒ½åŒ¹é…ï¼ˆæ­Œå+æ­Œæ‰‹åï¼‰
  - 4æºFallback: QQ â†’ Joox â†’ NetEase â†’ Kugou -> bilibili
  - æ¯æºé‡è¯•3æ¬¡
- `fallback_chain.go`: gRPCå®¢æˆ·ç«¯ + ä¸­é—´ä»¶æ ˆ
**gRPCå®¢æˆ·ç«¯é›†æˆ**:
- `internal/client/auth_client.go`: auth-svc gRPCå®¢æˆ·ç«¯
- `internal/client/user_client.go`: user-svc gRPCå®¢æˆ·ç«¯
- `internal/client/pool.go`: è¿æ¥æ± ç®¡ç†

**ä¸­é—´ä»¶æ ˆ**:
- `internal/middleware/request_id.go`: æ³¨å…¥X-Request-ID
- `internal/middleware/telemetry.go`: OpenTelemetryè¿½è¸ª
- `internal/middleware/rate_limiter.go`: IP + UseråŒç»´åº¦é™æµ
- `internal/middleware/jwt. + æœåŠ¡å‘ç°
**æ–‡ä»¶**: `server/services/proxy-svc/cmd/main.go`
- HTTPè·¯ç”±é…ç½®(Gin)
- gRPCå®¢æˆ·ç«¯åˆå§‹åŒ–(auth-svc:9001, user-svc:9003)
- Consul DNSæœåŠ¡å‘ç°
- gRPCè¿æ¥å¥åº·æ£€æŸ¥
- HTTPå¥åº·æ£€æŸ¥ç«¯ç‚¹
#### æ­¥éª¤19: proxy-svc - è·¯ç”±è½¬å‘
**æ–‡ä»¶**: `server/services/proxy-svc/cmd/main.go`
- è·¯ç”±é…ç½®
- å†…éƒ¨æœåŠ¡å‘ç°ï¼ˆConsul DNSï¼‰
- å¥åº·æ£€æŸ¥

---

### é˜¶æ®µ4: ç”¨æˆ·å†…å®¹æœåŠ¡ï¼ˆç¬¬6-7å‘¨ï¼‰

#### æ­¥éª¤20: user-svc - é¢†åŸŸå±‚
**æ–‡ä»¶**: `server/services/user-svc/internal/domain/`
- `favorite.go`: æ”¶è—å®ä½“ï¼ˆè½¯åˆ é™¤ï¼‰
- `history.go`: æ’­æ”¾å†å²å®ä½“ï¼ˆå¸¦æ­Œåå†—ä½™ï¼‰
- `playlist.go`: æ­Œå•å®ä½“ï¼ˆå¸¦æ­Œæ›²è®¡æ•°ï¼‰
- `playlist_song.go`: æ­Œå•-æ­Œæ›²å…³è”

#### æ­¥éª¤21: user-svc - ä»“å‚¨å±‚
**æ–‡ä»¶**: `server/services/user-svc/internal/repository/`
- `favorite_repo.go`: æ”¶è—CRUD + è½¯åˆ é™¤
- `history_repo.go`: å†å²CRUD + æ¸…ç†é€»è¾‘
- `playlist_repo.go`: æ­Œå•CRUD
- SQL: sqlcç”Ÿæˆ

#### æ­¥éª¤22: user-svc - gRPCæœåŠ¡ + HTTPå¤„ç†å±‚
**gRPCæœåŠ¡** (å†…éƒ¨è°ƒç”¨):
- `internal/grpc/user_server.go`: å®ç°UserServiceæ¥å£
  - æ”¶è—: AddFavorite, RemoveFavorite, ListFavorites
  - å†å²: AddHistory, ListHistory
  - æ­Œå•: CreatePlaylist, UpdatePlaylist, DeletePlaylist, ListPlaylists

**HTTPå¤„ç†å±‚** (å®¢æˆ·ç«¯è°ƒç”¨):
- `internal/handler/favorite_handler.go`: æ”¶è—HTTP API
- `internal/handler/history_handler.go`: å†å²HTTP API
- `internal/handler/playlist_handler.go`: æ­Œå•HTTP ç®¡ç†
- `cleanup_service.go`: Cronæ¸…ç†ä»»åŠ¡ï¼ˆæ–°å¢ï¼‰

#### æ­¥éª¤23: user-svc - HTTPå¤„ç†å±‚
**æ–‡ä»¶**: `server/services/user-svc/internal/handler/`
- `favorite_handler.go`: æ”¶è—API
- `history_handler.go`: å†å²API
- `playlist_handler.go`: æ­Œå•API

#### æ­¥éª¤24: user-svc - Cronä»»åŠ¡
**æ–‡ä»¶**: `server/services/user-svc/internal/cron/cron.go`
- æ¯æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œ
- æ¸…ç†è¶…è¿‡500æ¡çš„å†å²è®°å½•
- è®°å½•æ¸…ç†ç»Ÿè®¡

---

### é˜¶æ®µ5: å®æ—¶åŒæ­¥æœåŠ¡ï¼ˆç¬¬8å‘¨ï¼‰

#### æ­¥éª¤25: sync-svc - WebSocketç®¡ç†ï¼ˆå¿ƒè·³+é™åˆ¶ï¼‰
**æ–‡ä»¶**: `server/services/sync-svc/internal/ws/`
- `connection.go`: è¿æ¥å¯¹è±¡ï¼ˆå¢åŠ å¿ƒè·³å­—æ®µï¼‰
- `manager.go`: è¿æ¥ç®¡ç†å™¨
- `heartbeat.go`: å¿ƒè·³æ£€æµ‹ï¼ˆ30ç§’ï¼‰ï¼ˆæ–°å¢ï¼‰
- `limiter.go`: è¿æ¥æ•°é™åˆ¶ï¼ˆ10000ï¼‰ï¼ˆæ–°å¢ï¼‰
- `room.go`: æˆ¿é—´ç®¡ç†ï¼ˆæŒ‰UserIDåˆ†ç»„ï¼‰

**æ”¹è¿›ç‚¹**:
- 30ç§’å¿ƒè·³æ£€æµ‹ï¼Œè¶…æ—¶è‡ªåŠ¨æ–­å¼€
- æœ€å¤š10000å¹¶å‘è¿æ¥
- ä¼˜é›…å…³é—­

#### æ­¥éª¤26: sync-svc - ç¦»çº¿æ¶ˆæ¯ï¼ˆé˜Ÿåˆ—+ACKï¼‰
**æ–‡ä»¶**: `server/services/sync-svc/internal/offline/`
- `queue.go`: Redis Listç¦»çº¿é˜Ÿåˆ—
- `message.go`: æ¶ˆæ¯ç»“æ„ï¼ˆå«AckTokenï¼‰
- `ack.go`: ACKç¡®è®¤é€»è¾‘ï¼ˆæ–°å¢ï¼‰

**æ”¹è¿›ç‚¹**:
- ç¦»çº¿æ¶ˆæ¯å­˜å‚¨åˆ°Redis List
- å®¢æˆ·ç«¯ä¸Šçº¿æ—¶æ‹‰å–
- æ”¯æŒæ¶ˆæ¯ç¡®è®¤ï¼ˆACKååˆ é™¤ï¼‰

#### æ­¥éª¤27: sync-svc - Redis Pub/Subé›†æˆ
**æ–‡ä»¶**: `server/services/sync-svc/internal/pubsub/`
- `subscriber.go`: è®¢é˜…ç”¨æˆ·é¢‘é“
- `publisher.go`: å‘å¸ƒåŒæ­¥äº‹ä»¶
- è·¨å®ä¾‹æ¶ˆæ¯å¹¿æ’­

#### æ­¥éª¤28: sync-svc - HTTP + WebSocketå¤„ç†
**æ–‡ä»¶**: `server/services/sync-svc/internal/handler/`
- `ws_handler.go`: WebSocketå‡çº§ + æ¶ˆæ¯å¤„ç†
- `event_handler.go`: HTTPæ¥å£ï¼ˆè§¦å‘åŒæ­¥äº‹ä»¶ï¼‰

---

### é˜¶æ®µ6: ç®¡ç†æœåŠ¡ï¼ˆç¬¬9-10å‘¨ï¼‰

#### æ­¥éª¤29: admin-svc - ç®¡ç†å‘˜è®¤è¯ï¼ˆ2FAï¼‰
**æ–‡ä»¶**: `server/services/admin-svc/internal/domain/`
- `admin_user.go`: ç®¡ç†å‘˜å®ä½“ï¼ˆå¢åŠ TOTPå­—æ®µï¼‰
- `operation_log.go`: æ“ä½œæ—¥å¿—ï¼ˆç»“æ„åŒ–ï¼‰
- `daily_stats.go`: æ¯æ—¥ç»Ÿè®¡ï¼ˆæ–°å¢ï¼‰
- `anomalous_activity.go`: å¼‚å¸¸æ´»åŠ¨ï¼ˆæ–°å¢ï¼‰

#### æ­¥éª¤30: admin-svc - åŒå› ç´ è®¤è¯
**æ–‡ä»¶**: `server/services/admin-svc/internal/service/totp_service.go`
- ç”ŸæˆTOTPå¯†é’¥
- éªŒè¯TOTPç 
- äºŒç»´ç ç”Ÿæˆ


**é…ç½®åˆ†å±‚**:
- åŸºç¡€è®¾æ–½é…ç½®(PostgreSQL/Redis): **ä¸å¯é€šè¿‡ç®¡ç†åå°ä¿®æ”¹**
- ä¸šåŠ¡é…ç½®(JWT/API/SMS): é€šè¿‡ç®¡ç†åå°ä¿®æ”¹

**æ“ä½œæµç¨‹**:
- è¯»å–: ä»Consul KVè¯»å–(å¸¦ç¼“å­˜)
- å†™å…¥: 
  1. éªŒè¯é…ç½®æ ¼å¼
  2. å†™å…¥Consul KV
  3. å†™å…¥PostgreSQLå†å²è®°å½•
  4. å‘å¸ƒRedis Pub/Subé€šçŸ¥
  5. æ‰€æœ‰æœåŠ¡æ¸…é™¤ç¼“å­˜
- å›æ»š: ä»å†å²è®°å½•æ¢å¤åˆ°æŒ‡å®šç‰ˆæœ¬tgreSQL
- å˜æ›´é€šçŸ¥: Redis Pub/Subå¹¿æ’­
- ç‰ˆæœ¬æ§åˆ¶: PostgreSQLè®°å½•å†å²

#### æ­¥éª¤32: admin-svc - æ“ä½œå®¡è®¡ï¼ˆå‘Šè­¦ï¼‰
**æ–‡ä»¶**: `server/services/admin-svc/internal/service/audit_service.go`
- è®°å½•ç»“æ„åŒ–æ—¥å¿—ï¼ˆå«RequestIDï¼‰
- å¼‚å¸¸æ£€æµ‹:
  - 1å°æ—¶å†…ç¦ç”¨20ä¸ªç”¨æˆ·
  - éå·¥ä½œæ—¶é—´ä¿®æ”¹JWTé…ç½®
  - è¿ç»­ç™»å½•å¤±è´¥
- å‘Šè­¦é€šçŸ¥: Slack Webhook / Email

#### æ­¥éª¤33: admin-svc - æ•°æ®ç»Ÿè®¡ï¼ˆèšåˆ+å®æ—¶ï¼‰
**æ–‡ä»¶**: `server/services/admin-svc/internal/service/stats_service.go`
- å®šæ—¶èšåˆ: Cronæ¯æ—¥å‡Œæ™¨è®¡ç®—DailyStats
- å®æ—¶æŒ‡æ ‡: Rediså­˜å‚¨å½“æ—¥æ•°æ®
- Dashboard: è¯»å–èšåˆè¡¨ï¼ˆç§’çº§å“åº”ï¼‰

#### æ­¥éª¤34: admin-svc - å®¡è®¡æ—¥å¿—å¯¼å‡º
**æ–‡ä»¶**: `server/services/admin-svc/internal/handler/export_handler.go`
- CSVå¯¼å‡º
- Excelå¯¼å‡ºï¼ˆä½¿ç”¨ excelize åº“ï¼‰
- æ”¯æŒæ—¥æœŸèŒƒå›´ç­›é€‰

---

### é˜¶æ®µ7: åŸºç¡€è®¾æ–½é›†æˆï¼ˆç¬¬11å‘¨ï¼‰

#### æ­¥éª¤35: Consuléƒ¨ç½²ä¸é›†æˆ
- ConsulæœåŠ¡å™¨é›†ç¾¤ï¼ˆ3èŠ‚ç‚¹ï¼‰
- æ‰€æœ‰æœåŠ¡æ³¨å†Œ
- å¥åº·æ£€æŸ¥é…ç½®
- KV Storeé…ç½®è¿ç§»

#### æ­¥éª¤36: OpenTelemetryé›†æˆ
- OTel Collectoréƒ¨ç½²
- æ‰€æœ‰æœåŠ¡æ³¨å…¥TraceID
- Jaegeråç«¯é…ç½®
- Grafanaé›†æˆ

#### æ­¥éª¤37: ç›‘æ§å‘Šè­¦
- Prometheusé…ç½®
- Grafana Dashboard
- AlertManagerè§„åˆ™
- PagerDutyé›†æˆ

#### æ­¥éª¤38: æ—¥å¿—èšåˆ
- Elasticsearchéƒ¨ç½²
- Logstashé…ç½®
- Kibana Dashboard
- æ—¥å¿—ä¿ç•™ç­–ç•¥ï¼ˆ30å¤©ï¼‰

---

### é˜¶æ®µ8: å®¢æˆ·ç«¯é€‚é…ï¼ˆç¬¬12å‘¨ï¼‰

#### æ­¥éª¤39: Flutterå®¢æˆ·ç«¯é€‚é…
- æ–°APIå¯¹æ¥
- WebSocketé‡è¿é€»è¾‘ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
- ç¦»çº¿æ¶ˆæ¯æ‹‰å–
- è®¾å¤‡æŒ‡çº¹ä¸ŠæŠ¥

#### æ­¥éª¤40: Reactç®¡ç†åå°é€‚é…
- æ–°APIå¯¹æ¥
- é…ç½®ç®¡ç†ç•Œé¢ï¼ˆç‰ˆæœ¬æ§åˆ¶ï¼‰
- å®¡è®¡æ—¥å¿—å¢å¼ºï¼ˆå¼‚å¸¸é«˜äº®ï¼‰
- æ•°æ®ç»Ÿè®¡å›¾è¡¨

---

### é˜¶æ®µ9: æµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆç¬¬13å‘¨ï¼‰

#### æ­¥éª¤41: å•å…ƒæµ‹è¯•
- æ‰€æœ‰æœåŠ¡å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- Mockå¤–éƒ¨ä¾èµ–

#### æ­¥éª¤42: é›†æˆæµ‹è¯•
- ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•
- WebSocketè¿æ¥æµ‹è¯•
- Fallbacké“¾æµ‹è¯•

#### æ­¥éª¤43: æ€§èƒ½æµ‹è¯•
- å‹æµ‹å·¥å…·: k6
- ç›®æ ‡:
  - ç™»å½•QPS: 1000
  - æ’­æ”¾URL QPS: 5000
  - WebSocketå¹¶å‘: 10000
  - P99å»¶è¿Ÿ < 200ms

#### æ­¥éª¤44: æ··æ²Œæµ‹è¯•
- æ¨¡æ‹Ÿç½‘ç»œæ•…éšœ
- æ¨¡æ‹Ÿæ•°æ®åº“å®•æœº
- æ¨¡æ‹ŸRedisæ•…éšœ
- éªŒè¯é™çº§ç­–ç•¥

---

### é˜¶æ®µ10: éƒ¨ç½²ä¸Šçº¿ï¼ˆç¬¬14å‘¨ï¼‰

#### æ­¥éª¤45: Kuberneteséƒ¨ç½²
- æ‰€æœ‰æœåŠ¡å®¹å™¨åŒ–
- K8s Deploymenté…ç½®
- HPAè‡ªåŠ¨æ‰©ç¼©å®¹
- Ingressé…ç½®

#### æ­¥éª¤46: ç”Ÿäº§ç¯å¢ƒå‡†å¤‡
- SSLè¯ä¹¦é…ç½®ï¼ˆLet's Encryptï¼‰
- WAFé…ç½®ï¼ˆCloudflareï¼‰
- å¤‡ä»½ç­–ç•¥éªŒè¯
- ç¾éš¾æ¢å¤æ¼”ç»ƒ

#### æ­¥éª¤47: ç°åº¦å‘å¸ƒ
- 10% æµé‡ â†’ æ–°ç‰ˆæœ¬
- è§‚å¯ŸæŒ‡æ ‡ï¼ˆé”™è¯¯ç‡ã€å»¶è¿Ÿï¼‰
- é€æ­¥æ‰©å¤§è‡³100%

#### æ­¥éª¤48: è¿ç»´æ–‡æ¡£
- éƒ¨ç½²æ–‡æ¡£
- æ•…éšœæ’æŸ¥æ‰‹å†Œ
- APIæ–‡æ¡£ï¼ˆSwaggerï¼‰
- æ¶æ„å†³ç­–è®°å½•ï¼ˆADRï¼‰

---

## 5. é€æ­¥æ‰§è¡Œ

### ğŸ“ å½“å‰æ­¥éª¤: æ­¥éª¤0 - Protobufæ¥å£å®šä¹‰ + gRPCå°è£…å±‚

#### ğŸ¯ ç›®æ ‡
å»ºç«‹æœåŠ¡é—´é€šä¿¡çš„åŸºç¡€è®¾æ–½ï¼š
1. å®šä¹‰æ‰€æœ‰æœåŠ¡çš„ gRPC æ¥å£ï¼ˆ.protoæ–‡ä»¶ï¼‰
2. å®ç° gRPC å®¢æˆ·ç«¯/æœåŠ¡å™¨å°è£…å±‚  
3. å®ç°æ‹¦æˆªå™¨ï¼ˆæ—¥å¿—ã€è¿½è¸ªã€æ¢å¤ï¼‰
4. ä¸ºåç»­æ‰€æœ‰æœåŠ¡æä¾›é«˜æ€§èƒ½ã€ç±»å‹å®‰å…¨çš„RPCé€šä¿¡åŸºç¡€

#### ğŸ› ï¸ æŠ€æœ¯æ ˆ
- Go 1.23.0
- Protocol Buffers v3
- gRPC 1.60.0
- ä¾èµ–:
  - `google.golang.org/grpc`
  - `google.golang.org/protobuf`
  - `go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc`

#### ğŸ“ æ¶æ„å†³ç­–

**æ··åˆé€šä¿¡æ¶æ„**:
```
å®¢æˆ·ç«¯(Flutter/React)
      â†“
  HTTP REST + JSON
  (æ˜“ç”¨æ€§ä¼˜å…ˆ)
      â†“
   proxy-svc (APIç½‘å…³)
      â†“
  gRPC + Protobuf  
  (æ€§èƒ½ä¼˜å…ˆ)
      â†“
auth-svc / user-svc / sync-svc
```

**ä¸ºä»€ä¹ˆé€‰æ‹© gRPC:**
1. **æ€§èƒ½**: Protobufåºåˆ—åŒ–æ¯”JSONå¿«10xï¼ŒHTTP/2å¤šè·¯å¤ç”¨
2. **ç±»å‹å®‰å…¨**: .protoè‡ªåŠ¨ç”Ÿæˆä»£ç ï¼Œç¼–è¯‘æ—¶å‘ç°é”™è¯¯
3. **æµå¼ä¼ è¾“**: æ”¯æŒåŒå‘æµï¼Œé€‚åˆå®æ—¶åœºæ™¯
4. **ç»´æŠ¤æ€§**: æ¥å£å®šä¹‰å³æ–‡æ¡£ï¼Œå‡å°‘æ²Ÿé€šæˆæœ¬

**é¢„æœŸæ”¶ç›Š**:
- TokenéªŒè¯å»¶è¿Ÿ: 50ms â†’ 5ms (**10xæå‡**)
- æœåŠ¡é—´QPS: 2000 â†’ 15000 (**7.5xæå‡**)
- åºåˆ—åŒ–å¼€é”€: 1ms â†’ 0.1ms (**10xæå‡**)

#### ğŸ“ æ–‡ä»¶ç»“æ„
```
server/shared/pkg/crypto/
â”œâ”€â”€ aes.go          # AESåŠ å¯†è§£å¯†
â”œâ”€â”€ hash.go         # å¯†ç å“ˆå¸Œï¼ˆArgon2idï¼‰
â”œâ”€â”€ keygen.go       # å¯†é’¥ç”Ÿæˆ
â”œâ”€â”€ mask.go         # æ•æ„Ÿæ•°æ®è„±æ•ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ aes_test.go     # AESå•å…ƒæµ‹è¯•
â”œâ”€â”€ hash_test.go    # å“ˆå¸Œå•å…ƒæµ‹è¯•
â”œâ”€â”€ keygen_test.go  # å¯†é’¥ç”Ÿæˆæµ‹è¯•
â”œâ”€â”€ mask_test.go    # è„±æ•æµ‹è¯•
â””â”€â”€ doc.go          # åŒ…æ–‡æ¡£
```

#### ğŸ—ï¸ æ¥å£å®šä¹‰

```go
package crypto

// ===== AESåŠ å¯† =====

// EncryptAES256GCM ä½¿ç”¨AES-256-GCMåŠ å¯†æ•°æ®
// keyå¿…é¡»æ˜¯32å­—èŠ‚ï¼ˆ256-bitï¼‰
// è¿”å›æ ¼å¼: nonce(12å­—èŠ‚) + ciphertext + tag(16å­—èŠ‚)
func EncryptAES256GCM(plaintext, key []byte) ([]byte, error)

// DecryptAES256GCM ä½¿ç”¨AES-256-GCMè§£å¯†æ•°æ®
func DecryptAES256GCM(ciphertext, key []byte) ([]byte, error)

// ===== å¯†ç å“ˆå¸Œ =====

// HashPassword ä½¿ç”¨Argon2idå“ˆå¸Œå¯†ç 
// å‚æ•°: time=1, memory=64MB, threads=4
// è¿”å›æ ¼å¼: $argon2id$v=19$m=65536,t=1,p=4$<salt>$<hash>
func HashPassword(password string) (string, error)

// VerifyPassword éªŒè¯å¯†ç æ˜¯å¦åŒ¹é…å“ˆå¸Œ
func VerifyPassword(password, hash string) (bool, error)

// ===== å¯†é’¥ç”Ÿæˆ =====

// GenerateRandomKey ç”ŸæˆæŒ‡å®šé•¿åº¦çš„éšæœºå¯†é’¥
func GenerateRandomKey(size int) ([]byte, error)

// GenerateJWTSecret ç”ŸæˆJWTå¯†é’¥ï¼ˆ256-bitï¼ŒBase64ç¼–ç ï¼‰
func GenerateJWTSecret() (string, error)

// GenerateAESKey ç”ŸæˆAES-256å¯†é’¥ï¼ˆ32å­—èŠ‚ï¼‰
func GenerateAESKey() ([]byte, error)

// ===== æ•æ„Ÿæ•°æ®è„±æ•ï¼ˆæ–°å¢ï¼‰=====

// MaskPhone è„±æ•æ‰‹æœºå·: 13812345678 â†’ 138****5678
func MaskPhone(phone string) string

// MaskEmail è„±æ•é‚®ç®±: user@example.com â†’ u***@example.com
func MaskEmail(email string) string

// MaskToken è„±æ•Token: åªä¿ç•™å‰8ä½å’Œå8ä½
func MaskToken(token string) string

// MaskIDCard è„±æ•èº«ä»½è¯å·: æ˜¾ç¤ºå‰6ä½å’Œå4ä½
func MaskIDCard(idCard string) string
```

#### âš ï¸ é”™è¯¯å®šä¹‰

```go
var (
    ErrInvalidKeySize    = errors.New("crypto: invalid key size, must be 32 bytes for AES-256")
    ErrDecryptionFailed  = errors.New("crypto: decryption failed, ciphertext authentication failed")
    ErrInvalidHashFormat = errors.New("crypto: invalid hash format, expected argon2id format")
    ErrEmptyData         = errors.New("crypto: input data is empty")
    ErrShortCiphertext   = errors.New("crypto: ciphertext too short")
)
```

#### ğŸ“ å®ç°è¦ç‚¹

1. **AES-256-GCM**:
   - Nonceä½¿ç”¨`crypto/rand`ç”Ÿæˆï¼ˆ12å­—èŠ‚ï¼‰
   - æ¯æ¬¡åŠ å¯†ä½¿ç”¨ä¸åŒNonceï¼ˆé˜²æ­¢é‡æ”¾ï¼‰
   - è¿”å›æ ¼å¼: `nonce || ciphertext || tag`

2. **Argon2id**:
   - å‚æ•°: `time=1, memory=64*1024 KB, threads=4, keyLen=32`
   - Salt: 16å­—èŠ‚éšæœºç”Ÿæˆ
   - æ ¼å¼å…¼å®¹ PHC String Format

3. **è„±æ•è§„åˆ™**:
   - æ‰‹æœºå·: ä¿ç•™å‰3ä½å’Œå4ä½
   - é‚®ç®±: ç”¨æˆ·ååªæ˜¾ç¤ºé¦–å­—æ¯
   - Token: åªæ˜¾ç¤ºå‰8ä½å’Œå8ä½
   - èº«ä»½è¯: å‰6ä½å’Œå4ä½

4. **å®‰å…¨è€ƒé‡**:
   - ä½¿ç”¨`crypto/subtle.ConstantTimeCompare`é˜²æ­¢æ—¶åºæ”»å‡»
   - å¯†é’¥ä»`crypto/rand`ç”Ÿæˆï¼Œä¸ä½¿ç”¨`math/rand`
   - å“ˆå¸Œæ¯”è¾ƒå‰å…ˆéªŒè¯æ ¼å¼

#### âœ… å®Œæˆæ ‡å‡†

**Protobufå®šä¹‰**:
- [ ] auth.proto å®Œæ•´å®šä¹‰(4ä¸ªRPCæ–¹æ³•)
- [ ] user.proto å®Œæ•´å®šä¹‰(9ä¸ªRPCæ–¹æ³•)
- [ ] sync.proto å®Œæ•´å®šä¹‰(3ä¸ªRPCæ–¹æ³•)
- [ ] admin.proto å®Œæ•´å®šä¹‰(ç®¡ç†æ¥å£)
- [ ] ä»£ç ç”ŸæˆæˆåŠŸ(`make proto-gen`)
- [ ] ç”Ÿæˆçš„Goä»£ç æ— ç¼–è¯‘é”™è¯¯

**gRPCå·¥å…·åº“**:
- [ ] å®¢æˆ·ç«¯å·¥å…·å®ç°(è¿æ¥æ± ã€è¶…æ—¶ã€é‡è¯•)
- [ ] æœåŠ¡å™¨å·¥å…·å®ç°(é…ç½®ã€ä¼˜é›…å…³é—­)
- [ ] æ—¥å¿—æ‹¦æˆªå™¨(ç»“æ„åŒ–æ—¥å¿— + RequestID)
- [ ] è¿½è¸ªæ‹¦æˆªå™¨(OpenTelemetryé›†æˆ)
- [ ] æ¢å¤æ‹¦æˆªå™¨(Panicæ•è· + æ—¥å¿—)
- [ ] é”™è¯¯è½¬æ¢å·¥å…·(Status â†” ä¸šåŠ¡é”™è¯¯)

**æµ‹è¯•**:
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- [ ] MockæœåŠ¡å™¨/å®¢æˆ·ç«¯æµ‹è¯•
- [ ] æ‹¦æˆªå™¨æ­£ç¡®æ‰§è¡Œ
- [ ] é”™è¯¯ä¼ æ’­æ­£ç¡®
- [ ] Panicè¢«æ•è·

**æ€§èƒ½éªŒè¯**:
- [ ] gRPCè°ƒç”¨å»¶è¿Ÿ < 5ms(åŒæœºæˆ¿)
- [ ] å•è¿æ¥QPS > 10000(ç®€å•RPC)
- [ ] å‹æµ‹: 1000å¹¶å‘ç¨³å®šè¿è¡Œ
- [ ] å†…å­˜æ— æ³„æ¼

**æ–‡æ¡£**:
- [ ] .protoæ–‡ä»¶æ³¨é‡Šå®Œæ•´
- [ ] gRPCå·¥å…·åº“ä½¿ç”¨æ–‡æ¡£
- [ ] ç¤ºä¾‹ä»£ç (å®¢æˆ·ç«¯+æœåŠ¡ç«¯)

#### ğŸ” é£é™©ç‚¹

1. **æ¥å£è®¾è®¡ä¸å½“**: Protobufæ¥å£åæœŸéš¾æ”¹ï¼Œéœ€å……åˆ†è¯„å®¡
2. **ç‰ˆæœ¬å…¼å®¹æ€§**: æ¥å£å˜æ›´å¿…é¡»å‘åå…¼å®¹(æ·»åŠ å­—æ®µï¼Œä¸åˆ é™¤)
3. **æ€§èƒ½æœªè¾¾é¢„æœŸ**: ä¸å½“ä½¿ç”¨å¯¼è‡´æ€§èƒ½ä¸å¦‚HTTP(å¦‚é¢‘ç¹é‡è¿)
4. **è°ƒè¯•å›°éš¾**: gRPCéœ€ä¸“ç”¨å·¥å…·(grpcurlã€BloomRPC)
5. **æœåŠ¡å‘ç°æ•…éšœ**: Consulå¼‚å¸¸å¯¼è‡´æœåŠ¡ä¸å¯ç”¨
6. **è¿æ¥æ³„æ¼**: å®¢æˆ·ç«¯æœªæ­£ç¡®å…³é—­è¿æ¥
7. **æ¶ˆæ¯è¿‡å¤§**: è¶…è¿‡é»˜è®¤4MBé™åˆ¶

**ç¼“è§£æªæ–½**:
- æ¥å£è®¾è®¡é˜¶æ®µå¤šè½®è¯„å®¡
- å®Œå–„çš„é›†æˆæµ‹è¯•
- ç›‘æ§gRPCè¿æ¥æ•°ã€å»¶è¿Ÿã€é”™è¯¯ç‡
- å¼€å‘ç¯å¢ƒå¯ç”¨Reflection(æ–¹ä¾¿è°ƒè¯•)
- è¿æ¥ä½¿ç”¨deferå…³é—­

---

ğŸ’¬ **å›å¤"ç»§ç»­"å¼€å§‹å®ç°æ­¥éª¤0ï¼ˆProtobufå®šä¹‰ + gRPCå°è£…ï¼‰ï¼Œå®Œæˆåå°†è¿›å…¥æ­¥éª¤1ï¼ˆcryptoå·¥å…·åº“ï¼‰ã€‚æˆ–å›å¤"ä¿®æ”¹ [æ­¥éª¤å·]"è°ƒæ•´è®¾è®¡ã€‚**
